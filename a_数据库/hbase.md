


### 竖表 (hbase， 对计算层友好)
1. 如果大部分数据是稀疏的，例如，很多列中的数据为空或者缺失，那么竖表可能更适合。竖表可以更有效地存储稀疏数据，节省存储空间
2. 如果需要动态添加属性，竖表更具灵活性。在横表中，如果要添加新的属性，需要对整个表结构进行修改，而在竖表中，只需要添加新的行即可。
3. 支持灵活的计算，计算拼率不一样，计算完成时间不一样。

### 横表(mysql， 对查询层友好)
1. 查询和分析操作针对大量列进行操作，横表可能会更适合。横表可以利用列式存储和分析引擎，如Apache Parquet和Apache Arrow，提高查询性能。
2. 对数据进行实时处理和分析，横表可能更适合。横表中的相关属性在同一行中，可以更快地进行查询和分析。而竖表需要在多行中查找相关属性，性能较慢。

### 标签系统--合并两个
竖表对查询层不太友好：
1. 比如同时符合多个标签的多组合查询问题，需要进行合并成一张横表，一般使用es。
2. 比如根据value查userId, 也不太好，使用横表好操作。



### 标签系统的选型
1. 现状： 当前容量：2亿用户，每天日活：1亿日活，未来新增用户，每个用户100+标签，以后会增长
2. 峰值查询qps：1w+， 新增tag的插入tps(4小时写完)：3亿/4*60*60 = 2w+ 
3. 数据存储考虑：一个用户100个标签，根据标签值计算需要1kb， 2亿用户是1000G.
4. 业务需求： 根据uId 查询标签， 根据标签查询uid。



### 标签系统的设计
1. 标签的定义： 身份标签， 属性标签
2. 标签的存储： 元数据存储mysql， 标签数据存储 hbase + es， 
3. 标签的计算： 哪些标签实时计算， 哪些标签可以T+1；

### mysql 与 hbase 怎么选型
1. 看使用场景，比如标签系统，使用竖表更合适，用hbase；

