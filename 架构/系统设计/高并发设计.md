###千万级用户的大型网站，应该如何设计其高并发架构？
- 压力预估
   1. 1kw用户，根据28定律，每天有200w用户。
   2. 假设平均每个用户每次过来会有30次的点击，那么总共就有6000万的点击（PV）
   3. 一天24小时，根据28法则，大部分用户最活跃的时间集中在24*0.2=5小时内，
      大部分用户指的是（6000万点击 * 0.8 ≈ 5000万点击）
   4. 在5小时内会有5000万点击进来, 大概每秒钟会有3000左右的请求量
   5. 根据线上经验,一般高峰访问是活跃访问的2~3倍, 所以峰值有1w的每秒请求量
   
- 使用技术
   1. nginx/lvs 进行负载均衡
   2. 项目垂直拆分
   3. 分布式缓存来抗下对数据库的读请求压力
   4. 基于数据库主从架构做读写分离
   5. 分库分表
   6. 使用mq
 
### LVS VS nginx
-  lvs
    1. 工作在网络4层，仅做请求分发之用，流量并不从它本身出去，几十万并发
    2. 在使用上，一般最前端所采取的策略应是lvs，也就是DNS的指向应为lvs均衡器
    3. 可配置选项少; 安装和配置、测试就要花比较长的时间
    4. 工作稳定，因为其本身抗负载能力很强，所以稳定性高也是顺理成章，
    5. 各种lvs都有完整的双机热备方案，所以一点不用担心均衡器本身会出什么问题，节点出现故障的话，lvs会自动判别，所以系统整体是非常稳定的
    6. lvs中ldirectd也能支持针对服务器内部的情况来监控，但lvs的原理使其不能重发请求
    7. lvs就比较依赖于网络环境
-  nginx
    1. 工作在网络的7层，处理所有流量，受限于机器IO和配置，几万并发
    2. 在使用上，它可以针对http应用本身来做分流策略，比如针对域名、目录结构等
    3. 配置丰富； 安装和配置比较简单，测试起来也很方便，因为它基本能把错误用日志打印出来
    4. 本身的bug也还是难以避免的, 相比lvs。
    5. 没有现成的双机热备方案，所以跑在单机上还是风险较大，单机上的事情全都很难说
    6. 可以检测到服务器内部的故障，比如根据服务器处理网页返回的状态码、超时等等，并且
       会把返回错误的请求重新提交到另一个节点
    7. 对网络的依赖较小，理论上只要ping得通，网页访问正常，nginx就能连得通，nginx同时还能区分内外网，
        如果是同时拥有内外网的节点，就相当于单机拥有了备份线路
   
### 4层 VS 7层 负载均衡
- 四层负载均衡
   四层负载均衡主要工作在网络七层ISO协议的第四层，即传输层。传输层的代表协议为TCP。
   只需要对客户端的请求进行TCP/IP协议的包转发就可以实现负载均衡
   好处是性能非常快、只需要底层进行应用处理，而不需要进行一些复杂的逻辑。
- 7层负载均衡
    七层负载均衡是在应用层，它可以完成很多应用方面的协议请求。
    比如我们说的http应用的负载均衡，它可以实现http信息的改写、头信息的改写、安全应用规则控制、URL匹配规则控制、以及转发、rewrite等等的规则，所以在应用层的服务里面，我们可以做的内容就更多，
- 效率比较
   七层负载均衡效率没有四负载均衡高
   
   
   
   
   
   
3w单， 有2.4w单集中在1个小时内，     24000/3600 = 240/36 = 10,qps
   
   
   
   
   
   
   
   
   
   
   