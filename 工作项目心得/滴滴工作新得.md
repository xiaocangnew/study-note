工作-技术心得

1. mybatis中?tinyInt1isBit=false 时，  tinyint(1) —> java byte,      当为true时，  tinyint(1) —> java bolean


2. 本地环境起来app，线上不一定起得来，毕竟jar包不是全一样的。
3.  Mysql 插入时间相差几个小时，原因： 在jdbc url配置中增加时区：  serverTimezone=Asia/Shanghai
4. 解决bug的思路，心理路程： 例如：1. 没有打开分库分表开关导致for循环遍历同一个数据n次，如何抓住关键点 。2.没有增加shop_stock_reduction表的分库配置，导致其他表分表了，这个表没分，带来的错误，如何抓住关键点， 3. Mysql 插入时间错误，如何抓住关键点。
5. 取模运算， 小心超长被截断，计算就错了
6. shell脚本，在变量赋值时=两边不能有空格， 在if判断时=两边必须加空格
7. 项目通过后，在本地使用jar包执行一遍
8. 在jar包中读取文件，必须使用inputStream的初始方式，不能用getFile方式；
9. 当直接使用ip地址访问时，不需要https，http就可以了
10. Integer和byte进行equals比较， 返回false，即使值相等
11. 英语命名规则， 不要用倒装
12. mysql -h100.69.238.56 -P4192 -uroot -p123456 --default-character-set=utf8 wujie_database -e 'sql' > result.csv
    mysql -N 即为不输出title行
13. 更新时要卡好初始状态和数据的唯一性，防止更新其他数据， set status=5 where orderId=1 and status=2;
14. 更新时只更新需要的字段(Trader trader4Update = new Trade())，不要所有字段一起更新；
15. 说服别人前先说服自己，比如显示商品库存不足的需求，自己先好好想下可行吗

修复大量数据问题代码中启示：
1. 验证数据， 先10条，再100条，最后全量，不要一上去就全量，防止看着错误停不下来；
2. 如果中间出错，怎么补救， 有新的url，接受错误数据吗
3. 禁止一次修改大量数据，防止短时间大量数据修改，导致binlong，主从同步延时过高，占用带宽太高；
4. 不要在代码中放入文件，可以上传ftp，代码从ftp处读取；


售后商品退回需求时：
1. 聊天时录音，保证不遗漏信息；
2. 需求理解时， 自己是否具有方案话语权， 如果没有，则减少自己的决策， 把问题抛出来；
3. 尽快解决与别人对接的问题， 只是自己的问题，则可以往后拖，
     比如与售后和ofc对接的问题，要尽快解决，别人不一定有时间
     比如代码review问题，也是和别人对接的问题，要即使确定
     比如测试问题，给线上数据库加字段需要审核问题；
4. 主动性。永远不嫌弃。



1. 做事情时的思路：凡事要有章法，前(准备)中（操作）后（回滚+复盘）
     1. 依赖的上下游，(别人--> 项目 --> 分支 --> 模块 --> )
     2. 做事情前要有todo list
     3. 记录，自己记忆不好，要拿笔记下来

2. 做事情时善于联想：  
1。通用联想： 可靠性， 出了问题怎么解决；  
2。个性联想：依赖联想， 本身情况联想(对原原来业务的影响，对原来逻辑的影响，对原来数据对影响)，对别人造成的影响联想（对别人的qps影响，修改参数改变影响）
  

写代码时要注意：
1. 换行，一行代码不要太多
2. 自己写的代码要充分理解里面的含义，就是copy也要吃透
3. Copy原有的代码时，要充分理解原有代码的逻辑和背后的思路，他们为什么要那么写，不要简单的copy，
4.  要一个字段一个字段的深究；
5. 先校验，再做逻辑

上线时，如果有表改动，需要周知上下游 业务 + es + 数据仓库


快速理解业务：
1. 了解wiki， 新人入门—> 业务总览 —> 架构设计—> 子模块需求
2. 查看数据库表， 重点看核心表的状态机
3. 查看代码


--办公室政治： 抢活，哪都存在，即使是技术工作者也存在；
              产出，要有产出，否则存在的价值是什么；
              
-目前存在的问题：
1. 业务需求理解的慢， 很多细节想不到
   如何改变这个问题：
2. 编码慢，很多天工作不如琦哥一天的工作量
         如何改变这个？
           1. 好的代码是一次性写出来的， 不要想着以后再改，基本不可能；
           2. 代码写完后要自己review三次：
                 2.1 业务层面梳理一次；跟随业务流程走，从头到尾
                 2.2 传参数角度梳理一次，一个接口一个接口对
                 2.3 整体过一遍，看逻辑上有没有问题
                 

-- 面向okr 开发
1. 每月开始时，思考这个月的目标，每周有一个目标，每天一个小目标


- 技术分享能力
1。如何做技术分享， 如何做业务分享， 如何做ppt


### [接口偶尔超时排查，毛刺](https://blog.csdn.net/u012811805/article/details/106547473)
0. 该接口在时间点上进行了大量调用？
1. jvm导致， jvm清理垃圾时间长, (young gc线程数过多，导致上下文切换耗时)
2. 调用接口http连接用完？
3. 接口以来的下游其他服务阻塞？ 网络问题，io问题？


### 系统稳定性
降级： 自动发现+人工降级， 从design， 
不要重试，防止雪崩

稳定性问题
1.单点，  物理链路单点(dns，专线) ,机房单点，数据库单点，   通过冗余，镜像，主从
2.热点：  流量热点-微博， 数据热点-企业账户， 热点链路-首页， 通过隔离方式，热点down掉后非热点还可以用，  单独拆分服务，
3.抖动. 外部流量抖动， 积压导致雪崩(积压导致延时变长，超时)。   有容量的概念，做限流
4.服务自身抖动， 比如数据量增加，索引失效，缓存命中率下降，分页靠后导致性能降低； 保证性能平滑，不能有毛刺； 
5. 依赖方的抖动，    积压后对依赖方超时时间动态变短； 不能堵在那积压起来，要快速失败；

解决 事前监控，事中解决，事后复盘
1.  从场景上来做事情： 比如

### 订单超卖原因
- 滴滴交易中台的超卖
1. 新-老库使用双写， 由于老库扫表sql导致线程和cpu飙升，导致老库未修改成功状态，新老库订单状态不一致；
2. 未关单持续还库存, 在查询需要关单的接口时用了老库. 关单以老库为准
- didiwiki中的一个超卖
1. 使用redis锁姿势错误， 使用了try-finally写法，可能导致锁超时自动释放；

### 重试风暴
1. [网上例子](https://www.cnblogs.com/luojunwu/p/13128583.html)

### 数据库io被耗尽
1. user-center 一个大sql(调用离线库，感觉不是很重要)
导致导致用户中心应用的IO和内存被大量耗尽，影响其他接口，导致其他接口大面积超时